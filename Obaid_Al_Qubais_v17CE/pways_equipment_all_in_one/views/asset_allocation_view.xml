<odoo>
    <record id="view_allocation_request_form" model="ir.ui.view">
        <field name="name">asset.allocation.request.form</field>
        <field name="model">asset.allocation.request</field>
        <field name="arch" type="xml">
            <form string="Asset Allocation Request">
                <header>
                    <field name="state" widget="statusbar"
                           statusbar_visible="new,created,pending,approved,allocated,returned,'cancel',rejected"/>
                    <button name="action_pending" string="To Approve" type="object" class="btn-primary"
                            invisible="state != 'created'"/>
                    <button name="action_submit" string="Submit" type="object" class="btn-primary"
                            invisible="state not in ('new')"/>
                    <button name="action_approve" string="Approve" type="object" class="btn-primary"
                            invisible="state not in ('pending')"
                            groups="maintenance.group_equipment_manager"/>
                    <button name="action_reject" string="Reject" type="object" class="btn-primary"
                            invisible="state not in ('pending')"
                            groups="maintenance.group_equipment_manager"/>
                    <button name="action_allocate" string="Allocate" type="object" class="btn-primary"
                            invisible="state != 'approved'" groups="maintenance.group_equipment_manager"/>
                    <button name="action_return" string="Return" type="object" class="btn-primary"
                            invisible="state != 'allocated'" groups="maintenance.group_equipment_manager"/>
                    <button name="action_cancel" string="Cancel" type="object"
                            invisible="state not in ('new', 'pending', 'approved', 'allocated','created')"/>
                </header>
                <sheet>
                    <group>
                        <field name="asset_id" readonly="state == 'allocated'" options="{'no_create': True}"/>
                        <field name="asset_tag_id"/>
                        <field name="category_id" readonly="1"/>
                        <field name="employee_id" readonly="state == 'allocated'"/>
                        <field name="employee_barcode" readonly="1"/>
                        <field name="project_id" readonly="state == 'allocated'"/>
                        <!--                        <field name="allocation_type" readonly="state == 'allocated'"/>-->
                        <field name="company_id" readonly="state == 'allocated'"/>
                        <field name="location" readonly="state == 'allocated'"/>
                        <field name="allocation_date" readonly="state == 'allocated'"/>
                        <field name="returned_date" readonly="1"/>
                        <field name="rejection_reason" readonly="1"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
    <record id="action_project_equipment_assets" model="ir.actions.act_window">
        <field name="name">Assets</field>
        <field name="res_model">maintenance.equipment</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('project_id', '=', active_id)]</field>
        <field name="context">{}</field>
    </record>

    <record id="view_project_form_inherit_assets" model="ir.ui.view">
        <field name="name">project.project.form.asset.smartbutton</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@class='oe_button_box']" position="inside">
                <button type="action"
                        name="%(pways_equipment_all_in_one.action_project_equipment_assets)d"
                        icon="fa-cogs"
                        class="oe_stat_button"
                        invisible="equipment_count == 0">
                    <div class="o_stat_info">
                        <span class="o_stat_value">
                            <field name="equipment_count" widget="statinfo"/>
                        </span>
                    </div>
                </button>
            </xpath>
        </field>
    </record>

    <record id="view_asset_allocation_request_tree" model="ir.ui.view">
        <field name="name">asset.allocation.request.tree</field>
        <field name="model">asset.allocation.request</field>
        <field name="arch" type="xml">
            <tree>
                <field name="asset_id"/>
                <field name="employee_id"/>
                <field name="asset_tag_id"/>
                <field name="project_id"/>
                <field name="allocation_date"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
    <record id="view_maintenance_equipment_search_custom" model="ir.ui.view">
        <field name="name">maintenance.equipment.search</field>
        <field name="model">maintenance.equipment</field>
        <field name="arch" type="xml">
            <search>
                <field name="employee_id" string="Employee"/>
                <field name="asset_tag_id" string="Asset Tag"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_employee" string="Employee" context="{'group_by': 'employee_id'}"/>
                    <filter name="group_by_asset_tag" string="Asset Tag" context="{'group_by': 'asset_tag_id'}"/>
                </group>
            </search>
        </field>
    </record>
    <record id="maintenance_equipment_tree_inherit_asset_tag" model="ir.ui.view">
        <field name="name">maintenance.equipment.tree.asset.tag</field>
        <field name="model">maintenance.equipment</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='department_id']" position="after">
                <field name="asset_tag_id"/>
            </xpath>
        </field>
    </record>
    <record id="view_maintenance_team_kanban_custom" model="ir.ui.view">
        <field name="name">maintenance.team.kanban.custom</field>
        <field name="model">maintenance.team</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column" create="false" editable="false">
                <field name="color"/>
                <field name="card_type"/>
                <field name="name"/>
                <field name="total_asset_count"/>
                <field name="allocated_asset_count"/>
                <field name="unallocated_asset_count"/>
                <field name="total_room_count"/>scrapped_asset_count
                <field name="occupied_room_count"/>
                <field name="vacant_room_count"/>
                <field name="it_asset_allocation_count"/>
                <field name="scrapped_asset_count"/>
                <field name="tools_allocation_count"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_kanban_card shadow rounded p-3">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h4>
                                    <field name="name"/>
                                </h4>
                                <div class="o_kanban_color_picker"/>
                            </div>

                            <t t-if="record.card_type.raw_value == 'asset'">
                                <div t-attf-type="action"
                                     t-attf-data-action-id="maintenance.action_maintenance_equipment"
                                     class="border rounded p-2 mb-2 bg-light cursor-pointer">
                                    <h5 class="text-primary mb-2">Asset Statistics</h5>
                                    <div>
                                        <strong>Total Assets:</strong>
                                        <field name="total_asset_count"/>
                                    </div>
                                    <div>
                                        <strong>Allocated:</strong>
                                        <field name="allocated_asset_count"/>
                                    </div>
                                    <div>
                                        <strong>Unallocated:</strong>
                                        <field name="unallocated_asset_count"/>
                                    </div>
                                </div>
                            </t>

                            <t t-if="record.card_type.raw_value == 'camp'">
                                <div t-attf-type="action" t-attf-data-action-id="maintenance.action_camp_room_list"
                                     class="border rounded p-2 mb-2 bg-light cursor-pointer">
                                    <h5 class="text-success mb-2">Camp Room Statistics</h5>
                                    <div>
                                        <strong>Total Rooms:</strong>
                                        <field name="total_room_count"/>
                                    </div>
                                    <div>
                                        <strong>Occupied:</strong>
                                        <field name="occupied_room_count"/>
                                    </div>
                                    <div>
                                        <strong>Vacant:</strong>
                                        <field name="vacant_room_count"/>
                                    </div>
                                </div>
                            </t>

                            <t t-if="record.card_type.raw_value == 'it'">
                                <div class="o_kanban_card oe_kanban_global_click mb-2" t-attf-type="action"
                                     t-attf-data-action-id="maintenance.action_it_asset_allocation_list"
                                     style="border: 1px solid #ccc; border-radius: 10px; padding: 10px; background-color: #e8f0fe;">
                                    <h5 style="color:#3367d6;">IT Asset Allocation</h5>
                                    <div>
                                        <strong>Allocated:</strong>
                                        <field name="it_asset_allocation_count"/>
                                    </div>
                                </div>
                            </t>
                            <t t-if="record.card_type.raw_value == 'tools'">
                                <div class="o_kanban_card oe_kanban_global_click mb-2" t-attf-type="action"
                                     t-attf-data-action-id="maintenance.action_tools_maintenance_equipment"
                                     style="border: 1px solid #ccc; border-radius: 10px; padding: 10px; background-color: #e8f0fe;">
                                    <h5 style="color:#3367d6;">Tools/Equipment Allocation</h5>
                                    <div>
                                        <strong>Allocated:</strong>
                                        <field name="tools_allocation_count"/>
                                    </div>
                                </div>
                            </t>

                            <t t-if="record.card_type.raw_value == 'scrap'">
                                <div class="o_kanban_card oe_kanban_global_click" t-attf-type="action"
                                     t-attf-data-action-id="maintenance.action_maintenance_equipment_scrap"
                                     style="border: 1px solid #ccc; border-radius: 10px; padding: 12px; background-color: #f8d7da;">
                                    <h5 class="text-danger">Scrapped Assets</h5>
                                    <div>
                                        <strong>Total:</strong>
                                        <field name="scrapped_asset_count"/>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_maintenance_team_form_card_type" model="ir.ui.view">
        <field name="name">maintenance.team.form.card.type</field>
        <field name="model">maintenance.team</field>
        <field name="inherit_id" ref="maintenance.maintenance_team_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="inside">
                <group string="Card Settings">
                    <field name="card_type"/>
                </group>
            </xpath>
        </field>
    </record>


    <record id="action_maintenance_equipment" model="ir.actions.act_window">
        <field name="name">Assets</field>
        <field name="res_model">maintenance.equipment</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="action_tools_maintenance_equipment" model="ir.actions.act_window">
        <field name="name">Tools/Equipment</field>
        <field name="res_model">tools.equipment.allocation</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_camp_room_list" model="ir.actions.act_window">
        <field name="name">Camp Rooms</field>
        <field name="res_model">camp.room</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="action_maintenance_equipment_scrap" model="ir.actions.act_window">
        <field name="name">Scrapped Assets</field>
        <field name="res_model">maintenance.equipment</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('asset_lifecycle_status', '=', 'scrap')]</field>
    </record>


    <record id="view_asset_allocation_request_search" model="ir.ui.view">
        <field name="name">asset.allocation.request.search</field>
        <field name="model">asset.allocation.request</field>
        <field name="arch" type="xml">
            <search>
                <field name="employee_barcode" string="Employee"/>
                <field name="asset_tag_id" string="Asset Tag"/>
                <group expand="0" string="Group By">
                    <filter name="group_by_employee" string="Employee" context="{'group_by': 'employee_barcode'}"/>
                    <filter name="group_by_asset_tag" string="Asset Tag" context="{'group_by': 'asset_tag_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_asset_allocation_request" model="ir.actions.act_window">
        <field name="name">Asset Allocation Requests</field>
        <field name="res_model">asset.allocation.request</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_asset_allocation_request_tree"/>
    </record>

    <menuitem id="menu_allocation_request" name="Asset Allocation Requests"
              action="action_asset_allocation_request"/>

</odoo>
